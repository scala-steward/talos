<html><head><title>Talos: Fallbacks</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Vasilis Nicolaou" /><meta name="description" content="Lawful circuit breakers in Scala" /><meta name="og:image" content="/talos/img/poster.png" /><meta name="image" property="og:image" content="/talos/img/poster.png" /><meta name="og:title" content="Talos: Fallbacks" /><meta name="title" property="og:title" content="Talos: Fallbacks" /><meta name="og:site_name" content="Talos" /><meta name="og:url" content="" /><meta name="og:type" content="website" /><meta name="og:description" content="Lawful circuit breakers in Scala" /><link rel="icon" type="image/png" href="/talos/img/favicon.png" /><meta name="twitter:title" content="Talos: Fallbacks" /><meta name="twitter:image" content="/talos/img/poster.png" /><meta name="twitter:description" content="Lawful circuit breakers in Scala" /><meta name="twitter:card" content="summary_large_image" /><meta name="twitter:creator" content="@vaslabs" /><link rel="icon" type="image/png" sizes="16x16" href="/talos/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/talos/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/talos/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/talos/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/talos/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/talos/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/talos/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/talos/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/talos/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/talos/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/talos/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/talos/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/talos/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/talos/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/talos/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/talos/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/talos/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/talos/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/talos/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/talos/img/favicon310x150.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/talos/highlight/styles/default.css" /><link rel="stylesheet" href="/talos/css/style.css" /><link rel="stylesheet" href="/talos/css/palette.css" /><link rel="stylesheet" href="/talos/css/codemirror.css" /><link rel="stylesheet" href="/talos/css/home.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/talos/" class="brand"><div class="brand-wrapper"><span>Talos</span></div></a></li> <li><a href="/talos/events/events.html" class="">Events</a></li> <li><a href="/talos/kamon/kamon.html" class="">Kamon</a></li> <li><a href="/talos/dashboard/hystrixDashboard.html" class="">Dashboard</a></li> <li><a href="/talos/gateway/" class="">API Gateway</a></li> <li><a href="/talos/advanced/" class="">Advanced</a> <ul class="sub_section"> <li><a href="/talos/monix/monix.html" class="">Monix circuit breakers</a></li> <li><a href="/talos/talostypeclass/generic.html" class="">Generic solution</a></li></ul></li> <li><a href="/talos/laws/" class="">Talos Laws</a> <ul class="sub_section"> <li><a href="/talos/laws/timeouts.html" class="">Timeout laws</a></li> <li><a href="/talos/laws/monitoring.html" class="">Monitoring laws</a></li> <li><a href="/talos/laws/fallbacks.html" class="">Fallback laws</a></li></ul></li></ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li id="gh-eyes-item" class="hidden-xs"><a href="https://github.com/vaslabs/talos"><i class="fa fa-eye"></i><span>WATCH<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs"><a href="https://github.com/vaslabs/talos"><i class="fa fa-star-o"></i><span>STARS<span id="stars" class="label label-default">--</span></span></a></li><li><a href="#" onclick="shareSiteTwitter('Talos Lawful circuit breakers in Scala');"><i class="fa fa-twitter"></i></a></li><li><a href="#" onclick="shareSiteFacebook('Talos Lawful circuit breakers in Scala');"><i class="fa fa-facebook"></i></a></li><li><a href="#" onclick="shareSiteGoogle();"><i class="fa fa-google-plus"></i></a></li></ul></div></div></div></div><div id="content" data-github-owner="vaslabs" data-github-repo="talos"><div class="content-wrapper"><section><h2 id="fallback-law">Fallback Law</h2>

<p>Fallbacks are also supported by Talos. As suggested from literature[1] the users should involve the stakeholders to define
the course of action upon Circuit Breaker introduced failures. From the engineering perspective this means that the user
should be able to pass a function that will be executed in the case of a failure.</p>

<p>Such action is modeled as:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">def</span> <span class="nf">protectWithFallback</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">E</span><span class="o">](</span><span class="n">task</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">A</span><span class="o">],</span> <span class="n">fallback</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">E</span><span class="o">])</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">Either</span><span class="o">[</span><span class="kt">E</span>, <span class="kt">A</span><span class="o">]]</span>
</code></pre></div></div>

<p>The result of the user will be an Either to aid the reasoning of whether a successful call or a fallback was executed.</p>

<p>The law then on fallbacks goes a bit more: We define a fallback as a fast call. This is inspired a bit from
Hystrix[2] which limits the in-flight fallback calls. Instead, at the current stage, Talos is forcing the fallbacks to execute
within 10 milliseconds.</p>

<p>The fallback promises in summary are the following:</p>
<ul>
  <li>A user can define a fallback, whose result will be stored in the Left side of an Either.</li>
  <li>A fallback has only 10ms time to be completed, otherwise the fallback is rejected and a FallbackRejected event is published.</li>
  <li>Upon a successful fallback execution, a FallbackSuccess event is published.</li>
  <li>If the user defined fallback causes an exception, a FallbackFailure event is published.</li>
  <li>Fallbacks are executed in these scenarios:
    <ul>
      <li>A protected call failed or timed out.</li>
      <li>The circuit breaker is tripped.</li>
    </ul>
  </li>
</ul>

<h2 id="references">References</h2>

<ol>
  <li>Michael T. Nygard. Release It!: Design and Deploy Production-Ready Software (Pragmatic Programmers). Pragmatic Bookshelf, 2007.</li>
  <li>https://github.com/Netflix/Hystrix</li>
</ol>
</section></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/talos/highlight/highlight.pack.js"></script><script>hljs.configure({languages:['scala','java','bash']});
hljs.initHighlighting();
              </script><script>((window.gitter = {}).chat = {}).options = {
room: 'vaslabs/talos'};</script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js"></script><script src="/talos/js/main.js"></script></body></html>